<!DOCTYPE html> <html lang="en" class="no-js"><head ><meta name="keywords" content="message-media, reactjs, javascript" /> <meta name="description" content="Tutorial on how to block page navigation in ReactJS (React Router) using Router and Browser based techniques, includes code examples and how to extend with Redux." /> <meta charset="utf-8" /> <meta name="viewport" content="width=device-width, initial-scale=1." /> <meta name="author" content="Callum Silcock, contact@csi.lk" /> <meta name="reply-to" content="contact@csi.lk" /> <meta name="url" content="https://www.csi.lk" /> <meta name="coverage" content="Worldwide" /> <meta name="distribution" content="Global" /> <meta name="rating" content="General" /> <meta name="revisit-after" content="7 days" /> <meta name="og:type" content="text/html" /> <meta name="og:site_name" content="Callum Silcock | Lead Front End Developer & Conference Speaker" /> <meta name="og:email" content="contact@csi.lk" /> <meta name="og:phone_number" content="+447848472822" /> <meta name="theme-color" content="#26292c" /> <meta rel="icon" href="/favicon.ico" /> <meta rel="icon" href="/favicon.svg" type="image/svg+xml" /> <link rel="canonical" href="https://csi.lk/articles/blocking-page-navigation-in-reactjs.html" /> <title >Blocking page navigation in ReactJS (React Router)</title> <link rel="stylesheet" href="/styles/index.css?v=2.3.3" /></head> <body ><div hidden><span id="open-new-window">Opens in a new window</span> <span id="open-external">Opens an external site</span> <span id="open-new-window-external">Opens an external site in a new window</span> <span id="open-email">Opens email application</span></div> <div class="page-container fixed" data-testid="page-container"><a href="#content" class="skip"></a> <nav class="navigation"><a class="logo" href="/"><i class="icon-terminal" role="presentation"> </i> <h2 class="logo">Callum 
 Silcock</h2></a> <a href="/talks">talks</a> <a href="/timeline">timeline</a> <a href="/articles">articles</a> <a href="/bookshelf">bookshelf</a></nav> <main ><article id="content" class="article"><h1 >Blocking page navigation in ReactJS (React Router)</h1> <div class="article-subheader"><h2 class="article-date">Posted on:  <time datetime="2018-03-13">2018-03-13</time></h2> <a href="https://github.com/csi-lk/csi.lk/tree/master/src/articles/blocking-page-navigation-in-reactjs.md" target="_blank" rel="noopener" aria-describedby="open-new-window-external">source</a></div> <p><em>This article originally appeared on the <a href="https://developers.messagemedia.com/blocking-page-navigation-in-a-reactjs-application-react-router/" class="external" target="_blank" rel="noopener noreferrer">Message Media Developer Blog</a>, be sure to check it out.</em></p>
<p>Our product owner came to us with an interesting problem the other day, in the latest release of the <a href="https://hub.messagemedia.com" class="external" target="_blank" rel="noopener noreferrer">Message Media Front End</a> we have a new payment portal for customers to pay invoices, when a user is in the process of paying a bill we need to block navigation, or in his words:</p>
<blockquote>
<p>As a billing contact
I want to confirm my intent to leave the payment portal when my payment is still processing
So that I am aware that my payment hasn't finished processing</p>
</blockquote>
<h2>Blocking page navigation with React Router</h2>
<p>There seems to be <a href="https://github.com/ReactTraining/react-router/issues/4635" class="external" target="_blank" rel="noopener noreferrer">quite</a> <a href="https://github.com/ReactTraining/react-router/issues/2106" class="external" target="_blank" rel="noopener noreferrer">a</a> <a href="https://github.com/a-axton/react-router-confirm-navigation" class="external" target="_blank" rel="noopener noreferrer">few</a> methods of achieving this but most are pre v4…</p>
<h3>Let’s go to the docs</h3>
<p>React Router have a <a href="https://reacttraining.com/react-router/core/guides/philosophy" class="external" target="_blank" rel="noopener noreferrer">great online documentation</a> portal available, upon a quick search we find the <code>&lt;Prompt /&gt;</code> method.</p>
<blockquote>
<p>Prompt the user before navigating away from a page.</p>
</blockquote>
<p>Great! Let’s create a simple component to test.</p>
<h3>Simple Navigation Blocker Component</h3>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">PropTypes</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;prop-types&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Prompt</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-router-dom&#x27;</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">NavigationBlocker</span> = props =&gt; (
  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Prompt</span> <span class="hljs-attr">when</span>=<span class="hljs-string">{props.navigationBlocked}</span> <span class="hljs-attr">message</span>=<span class="hljs-string">&quot;Are you sure you want to leave?&quot;</span> /&gt;</span></span>
)

<span class="hljs-title class_">NavigationBlocker</span>.<span class="hljs-property">propTypes</span> = {
  <span class="hljs-attr">navigationBlocked</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">bool</span>.<span class="hljs-property">isRequired</span>,
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">NavigationBlocker</span>
</code></pre>
<p><em>Note: I’m specifically using <code>react-router-dom</code> but you can use plain ol’ <code>react-router</code> for this</em></p>
<p>Users should now see a prompt when clicking on links between routes but what about browser actions eg. Back / Forward buttons, Reload or Close?</p>
<h2>Blocking browser navigation with <code>onbeforeunload</code></h2>
<p>Once again you’re going to find many articles / stack overflow questions / tweets on how to implement this so I’d suggest</p>
<h3>Go back to the docs</h3>
<p>As per the <a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowEventHandlers/onbeforeunload" class="external" target="_blank" rel="noopener noreferrer">MDN Documentation</a>:</p>
<blockquote>
<p>The <code>WindowEventHandlers.onbeforeunload</code> event handler property contains the code executed when the <code>beforeunload</code> is sent.</p>
</blockquote>
<p>The problem is there’s many ways to implement this but as of 2017 most browsers block custom messages (for security reasons), as we don’t need to worry about this we can use something as simple as:</p>
<pre><code class="hljs language-javascript"><span class="hljs-comment">// Enable navigation prompt</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-property">onbeforeunload</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-literal">true</span>
<span class="hljs-comment">// Remove navigation prompt</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-property">onbeforeunload</span> = <span class="hljs-literal">null</span>
</code></pre>
<h3>Let’s add it to our existing component</h3>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">PropTypes</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;prop-types&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Prompt</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-router-dom&#x27;</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">NavigationBlocker</span> = props =&gt; {
  <span class="hljs-keyword">if</span> (props.<span class="hljs-property">navigationBlocked</span>) {
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">onbeforeunload</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-literal">true</span>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">onbeforeunload</span> = <span class="hljs-literal">null</span>
  }
  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Prompt</span> <span class="hljs-attr">when</span>=<span class="hljs-string">{props.navigationBlocked}</span> <span class="hljs-attr">message</span>=<span class="hljs-string">&quot;Are you sure you want to leave?&quot;</span> /&gt;</span></span>
}

<span class="hljs-title class_">NavigationBlocker</span>.<span class="hljs-property">propTypes</span> = {
  <span class="hljs-attr">navigationBlocked</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">bool</span>.<span class="hljs-property">isRequired</span>,
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">NavigationBlocker</span>
</code></pre>
<p>And just like that we have a navigation blocking component that we can easily turn on and off.</p>
<h2>Extending it with Redux</h2>
<p>I would suggest extending it to be a Global Navigation Blocker from here, when a processing redux action is sent send another to block navigation, when it resolves send another to resolve.</p>
<p>This allows you to include the blocker once at app level rather than including every time you need it.</p>
<p>This is what my implementation ended up looking like:</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">PropTypes</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;prop-types&#x27;</span>
<span class="hljs-keyword">import</span> { connect } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-redux&#x27;</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Prompt</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-router-dom&#x27;</span>

<span class="hljs-keyword">import</span> { getNavigationBlocked } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../navigation-selectors&#x27;</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">GlobalNavigationBlocker</span> = props =&gt; {
  <span class="hljs-keyword">if</span> (props.<span class="hljs-property">navigationBlocked</span>) {
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">onbeforeunload</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-literal">true</span>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">onbeforeunload</span> = <span class="hljs-literal">null</span>
  }
  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Prompt</span> <span class="hljs-attr">when</span>=<span class="hljs-string">{props.navigationBlocked}</span> <span class="hljs-attr">message</span>=<span class="hljs-string">&quot;Are you sure you want to leave?&quot;</span> /&gt;</span></span>
}

<span class="hljs-title class_">GlobalNavigationBlocker</span>.<span class="hljs-property">propTypes</span> = {
  <span class="hljs-attr">navigationBlocked</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">bool</span>.<span class="hljs-property">isRequired</span>,
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">mapStateToProps</span> = state =&gt; ({
  <span class="hljs-attr">navigationBlocked</span>: <span class="hljs-title function_">getNavigationBlocked</span>(state),
})

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">connect</span>(mapStateToProps)(<span class="hljs-title class_">GlobalNavigationBlocker</span>)
</code></pre>
<h2>Drawbacks</h2>
<p>Unfortunately because of how <code>onbeforeunload</code> can be misused, modern browsers have implemented some safeguards, as described in the docs:</p>
<blockquote>
<p>To combat unwanted pop-ups, some browsers don't display prompts created in <code>beforeunload</code> event handlers unless the page has been interacted with; some don't display them at all.</p>
</blockquote>
<p>And</p>
<blockquote>
<p>Various browsers ignore the result of the event and do not ask the user for confirmation at all … Firefox has a switch named <code>dom.disable_beforeunload</code> in about:config to enable this behaviour. (For eg.)</p>
</blockquote>
<p>Or, TL;DR:</p>
<ul>
<li>The user must interact with the page or the <code>onbeforeunload</code> event will not fire</li>
<li><code>onbeforeunload</code> can be turned off with browser settings
<ul>
<li><a href="https://stackoverflow.com/a/18115932" class="external" target="_blank" rel="noopener noreferrer">There are ways around this</a> using heavier handed approaches but I would not recommend them</li>
</ul>
</li>
</ul>
<p>You, also, cannot specify what message is shown to the user during this interaction.</p>
<p>All in all, I hope this saved you some time researching!</p>
</article></main> <footer class="footer undefined" data-testid="footer"><div ><p >© 2021</p> <a href="/">Callum Silcock</a></div> <div ><p >Contact</p> <a href="mailto:contact@csi.lk" target="_blank" rel="noopener noreferrer" aria-describedby="open-email">Email</a></div> <div ><p >Code</p> <a href="https://github.com/csi-lk/" target="_blank" rel="noopener noreferrer" aria-describedby="open-new-window-external">Github</a></div> <div ><p >Social</p> <a href="https://au.linkedin.com/in/callumsilcock" target="_blank" rel="noopener noreferrer" aria-describedby="open-new-window-external">LinkedIn</a> / <a href="https://stackoverflow.com/users/766958/csilk" target="_blank" rel="noopener noreferrer" aria-describedby="open-new-window-external">Stackoverflow</a></div></footer></div></body></html>