<html lang="en" class="no-js"><head ><meta name="keywords" content="message-media, reactjs, javascript"></meta> <meta name="description" content="Tutorial on how to block page navigation in ReactJS (React Router) using Router and Browser based techniques, includes code examples and how to extend with Redux."></meta> <meta charset="utf-8"></meta> <meta name="viewport" content="width=device-width, initial-scale=1."></meta> <meta name="author" content="Callum Silcock, contact@csi.lk"></meta> <meta name="reply-to" content="contact@csi.lk"></meta> <meta name="url" content="https://www.csi.lk"></meta> <meta name="coverage" content="Worldwide"></meta> <meta name="distribution" content="Global"></meta> <meta name="rating" content="General"></meta> <meta name="revisit-after" content="7 days"></meta> <meta httpEquiv="Expires" content="0"></meta> <meta httpEquiv="Pragma" content="no-cache"></meta> <meta httpEquiv="Cache-Control" content="no-cache"></meta> <meta httpEquiv="Content-Language" content="en"></meta> <meta name="og:type" content="text/html"></meta> <meta name="og:site_name" content="Callum Silcock | Lead Front End Developer & Conference Speaker"></meta> <meta name="og:email" content="contact@csi.lk"></meta> <meta name="og:phone_number" content="+447848472822"></meta> <title >ðŸ›‘ Blocking page navigation in ReactJS (React Router)</title> <link rel="stylesheet" href="/styles/index.css"></link></head> <body ><div class="page-container fixed"><a href="#content" class="skip">Skip to content</a> <nav class="navigation"><a class="logo" href="/"><i class="icon-terminal"></i> <h2 class="logo">Callum 
 Silcock</h2></a> <a href="articles.html">articles</a></nav> <main ><article id="content" class="article"><h1 >ðŸ›‘ Blocking page navigation in ReactJS (React Router)</h1> <p><em>This article originally appeared on the <a href="https://developers.messagemedia.com/blocking-page-navigation-in-a-reactjs-application-react-router/" class="external" target="_blank" rel="noopener">Message Media Developer Blog</a>, be sure to check it out.</em></p>
<p>Our product owner came to us with an interesting problem the other day, in the latest release of the <a href="https://hub.messagemedia.com" class="external" target="_blank" rel="noopener">Message Media Front End</a> we have a new payment portal for customers to pay invoices, when a user is in the process of paying a bill we need to block navigation, or in his words:</p>
<blockquote>
<p>As a billing contact
I want to confirm my intent to leave the payment portal when my payment is still processing
So that I am aware that my payment hasn't finished processing</p>
</blockquote>
<h2>Blocking page navigation with React Router</h2>
<p>There seems to be <a href="https://github.com/ReactTraining/react-router/issues/4635" class="external" target="_blank" rel="noopener">quite</a> <a href="https://github.com/ReactTraining/react-router/issues/2106" class="external" target="_blank" rel="noopener">a</a> <a href="https://github.com/a-axton/react-router-confirm-navigation" class="external" target="_blank" rel="noopener">few</a> methods of achieving this but most are pre v4â€¦</p>
<h3>Letâ€™s go to the docs</h3>
<p>React Router have a <a href="https://reacttraining.com/react-router/core/guides/philosophy" class="external" target="_blank" rel="noopener">great online documentation</a> portal available, upon a quick search we find the <code>&lt;Prompt /&gt;</code> method.</p>
<blockquote>
<p>Prompt the user before navigating away from a page.</p>
</blockquote>
<p>Great! Letâ€™s create a simple component to test.</p>
<h3>Simple Navigation Blocker Component</h3>
<pre><code class="language-javascript">import React from 'react'
import PropTypes from 'prop-types'
import { Prompt } from 'react-router-dom'

const NavigationBlocker = props =&gt; (
  &lt;Prompt when={props.navigationBlocked} message=&quot;Are you sure you want to leave?&quot; /&gt;
)

NavigationBlocker.propTypes = {
  navigationBlocked: PropTypes.bool.isRequired,
}

export default NavigationBlocker
</code></pre>
<p><em>Note: Iâ€™m specifically using <code>react-router-dom</code> but you can use plain olâ€™ <code>react-router</code> for this</em></p>
<p>Users should now see a prompt when clicking on links between routes but what about browser actions eg. Back / Forward buttons, Reload or Close?</p>
<h2>Blocking browser navigation with <code>onbeforeunload</code></h2>
<p>Once again youâ€™re going to find many articles / stack overflow questions / tweets on how to implement this so Iâ€™d suggest</p>
<h3>Go back to the docs</h3>
<p>As per the <a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowEventHandlers/onbeforeunload" class="external" target="_blank" rel="noopener">MDN Documentation</a>:</p>
<blockquote>
<p>The <code>WindowEventHandlers.onbeforeunload</code> event handler property contains the code executed when the <code>beforeunload</code> is sent.</p>
</blockquote>
<p>The problem is thereâ€™s many ways to implement this but as of 2017 most browsers block custom messages (for security reasons), as we donâ€™t need to worry about this we can use something as simple as:</p>
<pre><code class="language-javascript">// Enable navigation prompt
window.onbeforeunload = () =&gt; true
// Remove navigation prompt
window.onbeforeunload = null
</code></pre>
<h3>Letâ€™s add it to our existing component</h3>
<pre><code class="language-javascript">import React from 'react'
import PropTypes from 'prop-types'
import { Prompt } from 'react-router-dom'

const NavigationBlocker = props =&gt; {
  if (props.navigationBlocked) {
    window.onbeforeunload = () =&gt; true
  } else {
    window.onbeforeunload = null
  }
  return &lt;Prompt when={props.navigationBlocked} message=&quot;Are you sure you want to leave?&quot; /&gt;
}

NavigationBlocker.propTypes = {
  navigationBlocked: PropTypes.bool.isRequired,
}

export default NavigationBlocker
</code></pre>
<p>And just like that we have a navigation blocking component that we can easily turn on and off.</p>
<h2>Extending it with Redux</h2>
<p>I would suggest extending it to be a Global Navigation Blocker from here, when a processing redux action is sent send another to block navigation, when it resolves send another to resolve.</p>
<p>This allows you to include the blocker once at app level rather than including every time you need it.</p>
<p>This is what my implementation ended up looking like:</p>
<pre><code class="language-javascript">import React from 'react'
import PropTypes from 'prop-types'
import { connect } from 'react-redux'
import { Prompt } from 'react-router-dom'

import { getNavigationBlocked } from '../navigation-selectors'

const GlobalNavigationBlocker = props =&gt; {
  if (props.navigationBlocked) {
    window.onbeforeunload = () =&gt; true
  } else {
    window.onbeforeunload = null
  }
  return &lt;Prompt when={props.navigationBlocked} message=&quot;Are you sure you want to leave?&quot; /&gt;
}

GlobalNavigationBlocker.propTypes = {
  navigationBlocked: PropTypes.bool.isRequired,
}

export const mapStateToProps = state =&gt; ({
  navigationBlocked: getNavigationBlocked(state),
})

export default connect(mapStateToProps)(GlobalNavigationBlocker)
</code></pre>
<h2>Drawbacks</h2>
<p>Unfortunately because of how <code>onbeforeunload</code> can be misused, modern browsers have implemented some safeguards, as described in the docs:</p>
<blockquote>
<p>To combat unwanted pop-ups, some browsers don't display prompts created in <code>beforeunload</code> event handlers unless the page has been interacted with; some don't display them at all.</p>
</blockquote>
<p>And</p>
<blockquote>
<p>Various browsers ignore the result of the event and do not ask the user for confirmation at all â€¦ Firefox has a switch named <code>dom.disable_beforeunload</code> in about:config to enable this behaviour. (For eg.)</p>
</blockquote>
<p>Or, TL;DR:</p>
<ul>
<li>The user must interact with the page or the <code>onbeforeunload</code> event will not fire</li>
<li><code>onbeforeunload</code> can be turned off with browser settings
<ul>
<li><a href="https://stackoverflow.com/a/18115932" class="external" target="_blank" rel="noopener">There are ways around this</a> using heavier handed approaches but I would not recommend them</li>
</ul>
</li>
</ul>
<p>You, also, cannot specify what message is shown to the user during this interaction.</p>
<p>All in all, I hope this saved you some time researching!</p>
</article></main> <footer class="footer undefined"><div ><p >Â© 2020</p> <a href="/">Callum Silcock</a></div> <div ><p >Contact</p> <a href="mailto:contact@csi.lk" target="_blank">Email</a></div> <div ><p >Code</p> <a href="https://github.com/csi-lk/" target="_blank">Github</a></div> <div ><p >Social</p> <a href="https://au.linkedin.com/in/callumsilcock" target="_blank">LinkedIn</a> / <a href="https://stackoverflow.com/users/766958/csilk" target="_blank">Stackoverflow</a></div></footer></div></body></html>